---

layout: post
title: "DES加密的过程与实现"
date: 2013-12-29 21:58
comments: true

---
最近经常要使用DES或者3DES加密，虽然有现成的工具可以使用，但就是忍不住要看看加密的原理是啥，过程是怎么样的。老大说我又重复造轮子了，而且这造出来的轮子不圆。

首先千万别参考[维基百科的条目](http://zh.wikipedia.org/wiki/%E8%B3%87%E6%96%99%E5%8A%A0%E5%AF%86%E6%A8%99%E6%BA%96)，那个条目不管是中文还是英文都写得乱七八糟，看完还不知道整个过程到底是如何进行，而且在表述的时候还有诸多歧义。

下面举个例子来说明加密的过程，

明文：`52 61 69 73 75 69 73 65`  
密钥：`3b 38 98 37 15 20 f7 5e`  
密文：`bc 72 47 49 83 36 0e a8`

首先将明文转化成二进制，即：

	0101 0010
	0110 0001
	0110 1001
	0111 0011
	0111 0101
	0110 1001
	0111 0011
	0110 0101

然后经过下表（IP）进行初始置换，

	58 50 42 34 26 18 10 2
	60 52 44 36 28 20 12 4
	62 54 46 38 30 22 14 6
	64 56 48 40 32 24 16 8
	57 49 41 33 25 17  9 1
	59 51 43 35 27 19 11 3
	61 53 45 37 29 21 13 5
	63 55 47 39 31 23 15 7

置换完成之后变成：

	1111 1111
	0101 1001
	1001 0000
	1111 1110
	0000 0000
	1111 1110
	0010 0100
	0100 1001

然后我们要生成16个子密钥，原来的密钥是：

	0011 1011
	0011 1000
	1001 1000
	0011 0111
	0001 0101
	0010 0000
	1111 0111
	0101 1110

经过两个置换（PC-1）将64位的密钥分成两个28位的内容：

	57 49 41 33 25 17  9
	 1 58 50 42 34 26 18
	10  2 59 51 43 35 27
	19 11  3 60 52 44 36


	63 55 47 39 31 23 15
	 7 62 54 46 38 30 22
	14  6 61 53 45 37 29
	21 13  5 28 20 12  4

然后把置换后的两部分都进行左移（移动的位数后边再说明），左移之后合并成一个56位的内容，然后经过下边的选择置换：

	14	17	11	24	1	5
	3	28	15	6	21	10
	23	19	12	4	26	8
	16	7	27	20	13	2
	41	52	31	37	47	55
	30	40	51	45	33	48
	44	49	39	56	34	53
	46	42	50	36	29	32

第一个子密钥key[0]已经生成了：

	010111 000000 100001 001100
	010101 011000 111101 001111

不同的子密钥只是左移的位数不同，如下边所示：

	密钥编号： 0 1 2 3 4 5  6  7  8  9  10 11 12 13 14 15
	左移位数： 1 2 4 6 8 10 12 14 15 17 19 21 23 25 27 28

因此key[1]、key[2]……key[15]分别是：

	010100 010010 110111 110000
	011001 001001 011111 001100

	110101 001110 010010 000101
	110110 001011 010011 101111
	
	……

	000100 010111 110010 000001
	110101 111110 000101 001110
	

待续……
